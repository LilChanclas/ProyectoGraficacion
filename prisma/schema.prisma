generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Proyecto {
  id             String    @id @default(cuid())
  nombre         String
  descripcion    String?
  creado_en      DateTime  @default(now())
  actualizado_en DateTime  @updatedAt
  personas       Persona[]
  procesos       Proceso[]
  roles          Rol[]
}

model Rol {
  id          String    @id @default(cuid())
  proyecto_id String
  nombre      String
  personas    Persona[]
  proyecto    Proyecto  @relation(fields: [proyecto_id], references: [id], onDelete: Cascade)

  @@unique([proyecto_id, nombre])
  @@index([proyecto_id])
}

model Persona {
  id              String   @id @default(cuid())
  proyecto_id     String
  rol_id          String
  nombre_completo String
  correo          String?
  telefono        String?
  notas           String?
  creado_en       DateTime @default(now())
  proyecto        Proyecto @relation(fields: [proyecto_id], references: [id], onDelete: Cascade)
  rol             Rol      @relation(fields: [rol_id], references: [id])

  @@index([proyecto_id])
  @@index([rol_id])
}

model Proceso {
  id          String       @id @default(cuid())
  proyecto_id String
  nombre      String
  descripcion String?
  proyecto    Proyecto     @relation(fields: [proyecto_id], references: [id], onDelete: Cascade)
  subprocesos Subproceso[]

  @@unique([proyecto_id, nombre])
  @@index([proyecto_id])
}

model Subproceso {
  id                  String              @id @default(cuid())
  proceso_id          String
  nombre              String
  descripcion         String?
  proceso             Proceso             @relation(fields: [proceso_id], references: [id], onDelete: Cascade)
  subproceso_tecnicas SubprocesoTecnica[]

  @@unique([proceso_id, nombre])
  @@index([proceso_id])
}

model Tecnica {
  id                  String              @id @default(cuid())
  nombre              String
  tipo_metodo         TipoMetodoTecnica
  descripcion         String?
  subproceso_tecnicas SubprocesoTecnica[]
}

model SubprocesoTecnica {
  subproceso_id String
  tecnica_id    String
  subproceso    Subproceso @relation(fields: [subproceso_id], references: [id], onDelete: Cascade)
  tecnica       Tecnica    @relation(fields: [tecnica_id], references: [id], onDelete: Cascade)

  @@id([subproceso_id, tecnica_id])
  @@index([tecnica_id])
}

enum TipoMetodoTecnica {
  ENTREVISTA
  CUESTIONARIO
  OBSERVACION
  HISTORIA_USUARIO
  FOCUS_GROUP
  DOCUMENTOS
  SEGUIMIENTO_TRANSACCIONAL
}
